# v1.3.9 - Windows Artifact Upload Fix

## What Was Wrong in v1.3.8

✅ **PyInstaller Build**: Succeeded (30MB backend.exe created)  
✅ **Electron Builder**: Succeeded (210MB installer created)  
✅ **Checksums**: Succeeded  
❌ **Artifact Upload**: Failed - only uploaded 246 bytes (checksums only)

### Root Cause: Filename Pattern Mismatch

**Actual filename created by electron-builder:**
```
NeuroInsight Setup 1.3.8.exe  (with SPACES between words)
```

**Pattern in workflow artifact upload:**
```yaml
desktop_alone/electron-app/dist/NeuroInsight-Setup-*.exe  (with HYPHENS)
```

**Result**: Glob pattern didn't match, so only checksums were uploaded.

---

## The Fix (v1.3.9)

### Updated Artifact Upload Pattern

```yaml
path: |
  desktop_alone/electron-app/dist/NeuroInsight Setup *.exe     # With spaces
  desktop_alone/electron-app/dist/NeuroInsight*Setup*.exe      # Catch-all pattern
  desktop_alone/electron-app/dist/checksums-windows.txt
```

**Why two patterns**: Ensures we catch the file regardless of electron-builder's naming convention.

### Updated Checksums Generation

```bash
sha256sum NeuroInsight*Setup*.exe > checksums-windows.txt 2>/dev/null || 
sha256sum "NeuroInsight Setup"*.exe > checksums-windows.txt
```

**Why**: Tries both patterns to generate checksums correctly.

---

## Deployment

```bash
cd /mnt/nfs/home/urmc-sh.rochester.edu/pndagiji/hippo

git add .github/workflows/desktop-build-v15.yml
git add desktop_alone/electron-app/package.json
git add desktop_alone/V1.3.9_ARTIFACT_FIX.md

git commit -m "Fix Windows artifact upload - v1.3.9

Problem: v1.3.8 build succeeded but artifact upload failed
- Windows installer was created (210MB)
- But only checksums (246 bytes) were uploaded
- Caused by filename pattern mismatch

Fix:
- Updated glob pattern to match 'NeuroInsight Setup *.exe' (with spaces)
- Added fallback pattern for robustness
- Updated checksums generation to handle both patterns
- Bumped version to 1.3.9"

git push origin main

git tag -a desktop-v1.3.9 -m "Desktop v1.3.9 - Windows Artifact Upload Fix"
git push origin desktop-v1.3.9
```

---

## Expected Result

After the v1.3.9 build completes:

### Artifact Size:
```
neuroinsight-windows.zip: ~210 MB  (not 246 bytes!)
```

### Contents:
```
NeuroInsight Setup 1.3.9.exe    (210 MB)
checksums-windows.txt           (100 bytes)
```

### Verification:
Download the artifact and verify:
```powershell
# Windows
sha256sum "NeuroInsight Setup 1.3.9.exe"
# Compare with checksums-windows.txt
```

---

**Key Lesson**: electron-builder uses **spaces** in filenames, not hyphens!

