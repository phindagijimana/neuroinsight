NeuroInsight Architecture Overview

Components
- Frontend (Vite + React-in-HTML): `frontend/public/hippo_new_version.html`
  - Pages: Home, Jobs, Stats, Viewer
  - API base URL detection and Vite proxy (`/api`)
  - Polling jobs, uploads with progress, stats computation and viewer overlays

- Backend (FastAPI): `backend/`
  - `backend/api/upload.py`: upload endpoint with strict validation
  - `backend/api/visualizations.py`: serves overlay PNGs and viewer data
  - `backend/main.py`: app factory, CORS, routing

- Processing Pipeline
  - Celery worker: `workers/` consumes tasks
  - MRI processing: `pipeline/processors/mri_processor.py`
  - Visualization utilities: `pipeline/utils/visualization.py`

- Storage & Infra
  - Redis (broker/result), MinIO (object storage)
  - Postgres (jobs/metrics)
  - Singularity/Apptainer to run FastSurfer

Local Dev Entrypoints
- `RUN_ALL_LOCAL.sh` to start Redis, MinIO, backend, worker, frontend
- Logs: `logs/backend.out`, `logs/worker.out`, `logs/vite-56052.out`

Data Flow
1) Upload: Frontend → `/api/upload/` → StorageService saves object → Job created → Celery task enqueued
2) Processing: Worker runs FastSurfer → outputs under `data/outputs/<job_id>` → metrics saved
3) Visualization: Overlays generated by `visualization.generate_segmentation_overlays` → served via `/api/visualizations/...`
4) UI: Jobs/Stats/Viewer fetch data and render

Notable Conventions
- Overlays are saved upright (origin='upper'); UI does not flip images
- Segmentation resampled to T1 shape when needed
- Stats AI thresholds reflect HS cutoffs; lateralization derived accordingly

Operational Notes
- CPU default; GPU used when `nvidia-smi` available (singularity `--nv`)
- Cache-busting appended on overlay image URLs to avoid stale browser cache





